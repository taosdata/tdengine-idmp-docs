# 部署规划

## 最低硬件要求

为了保证系统正常运行，安装 TDengine IDMP 至少需要满足以下硬件要求：

- CPU：2 核心
- 内存：4 GB
- 硬盘：10 GB 可用空间

## 测点规模资源规划

根据不同的测点规模，建议按以下配置规划 TDengine IDMP 服务器资源：

### IDMP 服务资源配置

| 测点规模 | CPU | 内存 | 磁盘 | IDMP 实例数 | 适用场景 |
|:---:|:---:|:---:|:---:|:---:|:---|
| 1 万以下 | 4 核 | 8 GB | 50 GB | 1 | PoC/演示/小型项目 |
| 1 万 ~ 10 万 | 8 核 | 16 GB | 100 GB | 1 ~ 2 | 中小型生产环境 |
| 10 万 ~ 50 万 | 16 核 | 32 GB | 200 GB | 2 ~ 4 | 中型生产环境 |
| 50 万 ~ 100 万 | 32 核 | 64 GB | 500 GB | 4 ~ 8 | 大型生产环境 |
| 100 万以上 | 64 核+ | 128 GB+ | 1 TB+ | 8+ | 超大规模生产环境 |

### 外部依赖资源配置

当测点规模较大时，建议为外部依赖组件单独规划资源：

| 组件 | 1 万 ~ 10 万测点 | 10 万 ~ 50 万测点 | 50 万以上测点 |
|:---|:---:|:---:|:---:|
| Redis | 2 核 / 4 GB | 4 核 / 8 GB | 8 核 / 16 GB（集群） |
| MySQL | 4 核 / 8 GB | 8 核 / 16 GB | 16 核 / 32 GB（主从） |
| DFS | 100 GB | 500 GB | 1 TB+ |

### 规划建议

1. **磁盘类型**：生产环境建议使用 SSD，可显著提升查询与导入导出性能。
2. **网络带宽**：大规模测点场景建议万兆内网，确保数据采集与查询吞吐。
3. **多实例部署**：测点规模超过 10 万时，建议部署多个 IDMP 实例并通过网关进行负载均衡。
4. **外部依赖高可用**：生产环境建议 Redis/MySQL 配置主从或集群以保证高可用。
5. **预留扩展空间**：建议按预期峰值测点数的 1.5 倍规划资源，为业务增长预留空间。

> **说明**：以上配置为参考建议，实际资源需求还受采集频率、查询并发、数据保留周期等因素影响，请根据实际业务场景进行调整。关于 TDengine TSDB 的资源规划，请参考 [TDengine 容量规划](https://docs.taosdata.com/operation/planning/)。

## 操作系统和架构

目前，TDengine IDMP 支持以下操作系统和架构，如您期望在其它操作系统或架构上使用，可以[联系我们](https://www.taosdata.com/contactus)获取支持。

| 操作系统 | 支持版本 | x86_64 | arm64 |
|:---:|:---:|:---:|:---:|
| Ubuntu   | Ubuntu 20.04<br/>Ubuntu 22.04 | 支持 | 支持 |
| Debian   | Debian 10<br/>Debian 11<br/>Debian 12 | 支持 | 支持 |
| CentOS   | CentOS 8 | 支持 | 支持 |
| macOS 13 | macOS 13<br/>macOS 14<br/>macOS 15 | 支持 | 支持 |
| Windows  | n/a | 暂不支持 | 暂不支持 |

## 基础依赖

TDengine IDMP 的运行需要以下基础依赖：

1. Python: 3.12 版本
1. Java: 21 及以上版本
1. glibc: 2.25 及以上版本
1. TDengine TSDB-Enterprise: 3.3.7.0 及以上版本
1. 可用的 SMTP 邮件服务（当无法访问 Internet 时，需要在内网部署）
1. 正确的时区，关于时区的设置，请参考操作系统的用户手册

## 端口占用

TDengine IDMP 默认使用以下端口，请确保这些端口未被其他应用程序占用。

| 端口 | 协议 | 描述 |
|---|---|---|
| 6042 | HTTP | 外部端口，TDengine IDMP Web 页面 和 REST API 端口，用于浏览器访问页面和 API 接口，请确保防火墙开放对该端口的访问。|
| 6034 | HTTPS | 外部端口，TDengine IDMP Web 页面 和 REST API 的安全访问端口，用于浏览器通过 HTTPS 协议访问页面和 API 接口，生产环境建议启用并确保防火墙开放对该端口的访问。|
| 6038 | HTTP | 内部端口，TDengine IDMP 内部 H2 数据库服务 Web 页面端口，用于访问内部 H2 数据库。 |
| 6039 | TCP  | 内部端口，TDengine IDMP 内部 H2 数据库服务监听端口，用于访问内部 H2 数据库。 |
| 6040 | HTTP | 内部端口，TDengine IDMP 内部 chat 服务 API 端口，用于访问内部 chat 服务。 |

## 安装目录

TDengine IDMP 默认会安装在 `/usr/local/taos/idmp` 目录下。安装目录下各子目录的描述如下所示：

| 目录 | 描述 |
|---|---|
| app        | 软链接，目标为 standalone/app 目录 |
| backend    | 存放后端服务文件 |
| bin        | 存放启动/停止服务脚本 |
| chat       | 存放 chat 服务文件 |
| config      | 存放 TDengine IDMP 服务配置文件 |
| data       | 存放数据文件，软链接，目标为 /var/lib/taos |
| frontend   | 存放前端服务文件 |
| lib        | 存放后端服务依赖库文件 |
| logs       | 存放日志文件，软链接，目标为 /var/log/taos |
| quarkus    | 存放后端服务框架文件 |
| service    | 系统服务配置文件 |
| standalone | 存放前后端集成服务文件 |
