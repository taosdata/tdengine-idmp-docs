# 事件管理

除实时面板、报表之外，业务运营中最重要的就是处理各种事件，因此 IDMP 提供事件管理以及一定的事件根因分析的功能。在 IDMP 里，实时分析可以产生事件，但您也可以手动创建一个事件。每个元素都有自己的事件列表。但您可以从 IDMP 的主菜单"事件”里查看所有元素的事件列表。

### 事件的通用信息

对于任何一个事件，它有名字、描述信息、类别等基本信息。更重要的信息还有开始时间、结束时间、严重程度，相关联的元素和分析。事件还可以带有属性，分析计算时可以将输出结果输出到事件属性里。对于事件，可以添加备注信息便于协作，可以查看消息通知历史。

事件可以配置为是否需要确认。如果事件需要确认，那么在事件在关闭之前，如果在设定的通知消息重新发送的时间间隔里，没有得到确认，那么系统将重新发生通知消息，提醒用户尽快确认。您可从事件详情页或列表页进行确认。

### 事件属性

一个事件还可以有多个属性，这些属性用来记录事件发生时的某些值，便于事后分析问题。在实时分析的配置中，您可以将分析计算的结果输出到事件属性里。

### 趋势图分析

打开事件详情页面，或从事件列表页点击右侧三个点菜单，选择“趋势图分析”(Trend Chart Analysis)，可以把事件相关的属性自动添加到趋势图里，而且标出起止时间，还可以把任何其他时序数据添加到趋势图里，这样便于观察事件发生前后的趋势变化，分析事件发生的原因。

### 活动事件

如果一件事件已经发生，但并没有关闭，还在进行中，我们称之为活动事件。这个时候您可以确认、查看变化趋势图，分析原因。事件列表页会标出该事件是否还在活动中。如果事件关闭，系统不会再自动发送任何通知消息。

### 事件消息通知

根据通知规则配置，系统自动向指定的联系途径发送通知消息。具体流程如下：

- **初始通知**：事件发生时，系统根据通知规则与通知间隔，决定是否向通知规则中指定的联系途径发送通知消息。
- **重发机制**：若事件配置为需要确认，且在"重发间隔"内未被确认且事件未关闭，系统将按间隔重新发送通知消息。
- **升级机制**：若通知规则中设置了升级联系途径，在"升级间隔"内如果事件仍未被确认且未关闭，系统将向升级联系人发送通知。
- **通知停止**：事件确认后，系统不再发送任何通知消息。

### 事件通知规则

每个元素的所有事件共享一条通知规则，该规则定义了事件发生时的通知行为。

**通知规则配置参数**：

| 参数         | 说明                                                     |
| ------------ | -------------------------------------------------------- |
| 联系途径     | 接收通知的方式（邮件、飞书、Webhook等）                  |
| 重发间隔     | 未确认的活动事件重新发送通知的时间间隔                   |
| 升级联系途径 | 在升级间隔内事件仍未被确认时，向其发送通知的额外联系途径 |
| 升级间隔     | 触发升级通知的时间阈值                                   |
| 最大重发次数 | 单个事件最多重发的通知次数                               |
| 消息模板     | 通知消息的文本内容，支持变量替换                         |

### 事件模板

事件一定有模板，每个事件模板包含严重程度等基本配置，以及控制通知频率和确认机制的参数。

#### 核心功能

- **事件标记**：严重程度用于标记事件的级别，便于事件分类和分析。
- **通知频率控制**：通过"事件间通知最小发送间隔"参数防止过于频繁的通知。例如，设置为20分钟后，即使分析每分钟都触发事件，系统也仅在20分钟间隔后发送通知。
- **模板继承**：支持基础模板与子模板的继承关系，子模板可继承父模板的配置。

#### 事件模板配置参数

创建或编辑事件模板时，需要配置以下参数：

| 参数名称               | 说明                                                                                                                   | 示例                     |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------ |
| 名称                   | 事件模板的唯一标识符，用于在系统中识别该模板                                                                           | test-even-template       |
| 分类                   | 事件模板的分类，用于组织和管理模板。可选择"基础模板"或自定义分类                                                       | 基础模板                 |
| 仅作为基础模板         | 标识该模板是否仅作为基础模板使用，不直接创建事件。选择"是"表示该模板作为其他模板的基础，选择"否"表示可直接使用         | 否                       |
| 严重程度               | 事件的级别标记，包括：严重、主要、次要、警告、常规。                                                                   | 严重                     |
| 事件命名模式           | 定义事件名称的生成规则，可以包含变量和固定文本，用于自动生成事件名称                                                   | -                        |
| 允许扩展               | 是否允许基于此模板扩展创建新的事件模板。选择"是"表示其他模板可以继承此模板的配置                                       | 是                       |
| 允许确认               | 是否要求对事件进行人工确认。选择"是"时，未确认的事件将按照重发间隔继续发送通知，直到被确认或关闭，或达到最大通知次数   | 是                       |
| 原因代码               | 事件发生的原因分类，需要提前在“基础库/枚举集”中定义                                                                    | 电路故障                 |
| 原因代码值             | 原因代码的具体细分值，提供更详细的原因描述。                                                                           | 电压 / 电压过高          |
| 事件间通知最小发送间隔 | 同一分析产生的事件之间发送通知的最小时间间隔。只有当距离上一次通知时间超过此间隔时，才会发送新的通知，避免通知过于频繁 | 20 分钟                  |
| 描述                   | 事件模板的详细描述信息，用于说明该模板的用途和使用场景                                                                 | 用于监测电压过高异常事件 |

#### 配置指南

- **确认机制**：如果启用"允许确认"，未确认的活动事件将按照通知规则中的重发间隔持续发送通知，直到事件被确认或关闭，或达到最大通知次数。
- **通知间隔控制**：通过"事件间通知最小发送间隔"参数，可以避免同一分析频繁产生的事件导致消息过多。例如，设置为 20 分钟后，即使分析每分钟都触发事件，系统也只会在 20 分钟后发送通知。
- **原因代码**：合理使用原因代码和原因代码值，有助于对事件进行分类统计，便于后续的根因分析和问题追踪。
- **模板扩展**：启用"允许扩展"后，可以基于此模板创建子模板，子模板将继承父模板的部分配置，便于管理相似类型的事件。
